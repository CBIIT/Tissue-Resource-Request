<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($scope, snAttachmentHandler, spUtil, spModal, styleUtil) {
  /* widget controller */
  var c = this;
	styleUtil.addStyle('@media (min-width: 1200px){ .container { width: 70% !important; }}')
	c.edit = false;
	c.disabled = "disabled";
	c.debug = true;
	c.form = {};

	/* comment section value setting*/
	c.form.alternative_contact = c.data.item.alternative_contact;
	c.form.alternative_phone = c.data.item.alternative_phone;
	c.form.can_number = c.data.item.can_number;
	c.form.type = c.data.item.type;
	
	/* type 1 section value setting */
	if(c.form.type == 'Clinical Archives linked to protocol'){
		c.form.irb_protocol_number = c.data.item.irb_protocol; 
		c.form.patient_name = c.data.item.patient_name;
		c.form.case_block_1 = c.data.item.caseBlock1;
		c.form.case_block_2 = c.data.item.caseBlock2; 
		c.form.case_block_3 = c.data.item.caseBlock3;				
		c.form.case_block_4 = c.data.item.caseBlock4;
		c.form.case_block_5 = c.data.item.caseBlock5;
		c.form.material_being_requested = c.data.item.material_requested; 
		if(c.form.material_being_requested == 'Unstained Slides'){
			c.form.number_of_recuts = c.data.item.number_of_recuts;
			c.form.requested_thickness = c.data.item.requested_thickness;
		}else if(c.form.material_being_requested == 'Stained Slides'){
			c.form.he = c.data.item.he == 'true';
			c.form.special_stains = c.data.item.special_stains == 'true';
		}else if(c.form.material_being_requested == 'Tissue Shavings'){
			c.form.tissue_shaving_text = c.data.item.tissue_shaving_text;
		}else if(c.form.material_being_requested == 'Slide Signout From LP'){
			c.form.slide_signout_from_lp_text = c.data.item.slide_signout_from_lp_text;
		}else if(c.form.material_being_requested == 'Other Material'){
			c.form.other_material_specify = c.data.item.other_material_specify;
		}else if(c.form.material_being_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'){
			c.form.ffpe_tissue_block_text = c.data.item.ffpe_tissue_block_text;
		}
		c.form.special_processing_or_handling = c.data.item.special_processing_or_handling;
		c.form.intent_to_use = c.data.item.intent_to_use;
	}
	/* end of type 1 */
  
	c.editMode = function(){
		c.edit = true;
	}
	c.saveRecord = function(){
		$scope.server.get({
			action: 'update',
			record: c.form,
			sys_id: c.data.sys_id,
			comments: ''
		}).then(function(){
			c.edit = false;
			$scope.server.update();
		});
	}
	c.backToHome = function(){
		top.window.location = "/ncisp?id=manage_tissue_request_cat_item";
	}
	c.cancel = function(){
		c.edit = false;
	}
	c.approve = function(){
		if(c.data.isAdmin && (c.form.assigned_to == null || !c.form.assigned_to)){
			spModal.alert("<br/><center><span><font color='red'>Please select a staff member to assign to</font></span></center>");
		}else{
			spModal.open({
				title: "Warning",
				message: "<center><i class='fa fa-warning' aria-hidden='true'></i>  <b>Are you sure you want to approve this request?</b></center>"
			}).then(function(confirmed) {
				processRequest('approved');
			})	
		}

	}
	c.reject = function(){
		if(c.form.comment == null || c.form.comment.trim().length < 1){
				spModal.alert("<br/><center><span><font color='red'>Please supply a comment when rejecting a request</font></span></center>");
		}else{
			spModal.open({
				title: "Warning",
				message: "<center><i class='fa fa-warning' aria-hidden='true'></i>  <b>Are you sure you want to reject this request?</b></center>"
			}).then(function(confirmed) {
				processRequest('rejected');
			})
		}
	}
	function processRequest(action){
		$scope.server.get({
			action: 'process',
			status: action,
			assigned_to: c.form.assigned_to,
			sys_id: c.data.sys_id,
			comments: c.form.comment
		}).then(function(){
			top.window.location = "/ncisp?id=manage_tissue_request_cat_item";
		});
	}
	
	c.uploadAttachment = function(inputId){
		var files = document.getElementById(inputId).files;
		console.log(files.length);
		if (!files || !files.length) return;
		var file = files[0];
		var tableName = 'x_naci_tissue_requ_tissue_resource_request';
		var uploadParams = {
			// sysparm_fieldname: scope.fieldName
		};
		snAttachmentHandler.create(tableName, c.data.sys_id).uploadAttachment(file, uploadParams).then(function(response) {
			spModal.alert("<br/><center><span><font color='green'>File has been uploaded successfully!</font></span></center>");
		});				
	}
	
	c.deleteAttachment = function(attachmentId) {
		spModal.open({
			title: "Warning",
			message: "<center><i class='fa fa-warning' aria-hidden='true'></i>  <b>Are you sure you want to remove this file?</b></center>"
		}).then(function(confirmed) {
			snAttachmentHandler.deleteAttachment(attachmentId).then(function() {
			});
		})
	}
	c.notify = function(){
		
	}
	c.completed = function(){
		
	}
	spUtil.recordWatch($scope, "sys_attachment", "", function(name, data) {  
			spUtil.update($scope);
	});
	spUtil.recordWatch($scope, "x_naci_tissue_requ_tissue_request_comment", "", function(name, data) {  
			spUtil.update($scope);
	});
}]]></client_script>
        <controller_as>c</controller_as>
        <css>.label-bold {
  font-weight: bold;
  margin-top:20px;
  display: block;
}

.bg-white {
  background-color: white;
}

.p-5 {
  padding: 2.5rem;
}


.mr-5 {
  margin-right: 2.5rem;
}

.mb-3 {
  margin-bottom: 1.5rem;
}

.mt-20 {
 	margin-top: 20px; 
}
.mb-2 {
  margin-bottom: 1rem;
}

.br-4 {
  border-radius: 4px;
}

.shadow {
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
}

.bg-light-gray {
  background-color: #dadfe1;
}

.title-bold {
  font-weight: bold;
}

.action-buttons .btn.btn-primary {
  margin-left: 10px;
  min-width: 100px;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>approve_tissue_request</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Approve Tissue Request</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  /* populate the 'data' object */
  /* e.g., data.table = $sp.getValue('table'); */
	var str = gs.action.getGlideURI();
	var sys_id = str.get('sys_id');
	var approver = str.get('approver');
	data.item = {};
	data.sys_id = sys_id;
	data.comment = [];
  data.isAdmin = gs.getUser().isMemberOf('Tissue Resource Request LP Committee');
	data.localStaff = gs.getUser().isMemberOf('Tissue Resource Request Local Staff');
	
	var approverName = gs.getUserDisplayName().toString();
	//process request
	if(input){
		if(input.action != null && input.action.trim().length > 0){
			var comment = '';
			var status = '';
			if(input.action == 'update'){
				var param = input.record;
				var rec = new GlideRecord('x_naci_tissue_requ_tissue_resource_request');
				rec.get(input.sys_id);
				//set common section
				for(var key in param){
					rec.setValue(key, param[key]);
				}
				rec.updateMultiple();
				status = 'modified';
			}else if(input.action == 'process'){
				var proc = new GlideRecord('x_naci_tissue_requ_tissue_resource_request');
				proc.get(input.sys_id);
				proc.approval_action = input.status;
				if(data.isAdmin){
					proc.assigned_to = input.assigned_to.toString();
				}
				proc.update();
				status = input.status;
			}
			//add comments
			if(input.comments != null && input.comments.trim().length > 0){
				comment = input.comments;
			}
			var commen = new GlideRecord('x_naci_tissue_requ_tissue_request_comment');
			commen.initialize();
			commen.tissue_request_id = input.sys_id;
			commen.role = approver;
			commen.approver = approverName;
			commen.status = status;
			commen.comment = comment;
			commen.insert();
		}
	}
	
	//load selected request
	//load local comment
	var comments = new GlideRecord('x_naci_tissue_requ_tissue_request_comment');
			comments.addQuery('tissue_request_id', sys_id);
			comments.orderByDesc('sys_created_on');
			comments.query();
	while(comments.next()){
		var comm = {};
		comm.role = comments.role.toString();
		comm.approver = comments.approver.name.toString();
		comm.status = comments.status.toString();
		comm.comment = comments.comment.toString();
		comm.time = comments.sys_created_on.toString();
		data.comment.push(comm);
	}
	//load local staff name list if the user is admin
	data.staffs = [];
	if(data.isAdmin){
		var staff = new GlideRecord('sys_user_grmember');
				staff.addQuery('group.name', 'Tissue Resource Request Local Staff');
				staff.orderBy('user.name');
		staff.query();
		while(staff.next()){
			var item = {};
			item.label = staff.user.name.toString();
			item.value = staff.user.sys_id.toString();
			data.staffs.push(item);
		}
	}
	//load request
	var tissue = new GlideRecord('x_naci_tissue_requ_tissue_resource_request');
	    tissue.get(sys_id);
	    //set up common section
	    data.item.stage = tissue.stage.toString();
			data.item.number = tissue.number.toString();
			data.item.piName = tissue.principal_investigator.name.toString();
	    //get user information
			var gr_user = new GlideRecord('sys_user');
			if (gr_user.get(tissue.principal_investigator.toString())) {
				data.item.institution = gr_user.getValue('u_org_');
				data.item.branch = gr_user.department.name.toString();
				data.item.building = gr_user.getValue('u_building_name');
				data.item.room = gr_user.getValue('u_room');
				data.item.phone = gr_user.getValue('phone');
				data.item.email = gr_user.getValue('email');
			}
	    data.item.alternative_contact = tissue.alternative_contact.toString();
			data.item.alternative_phone = tissue.alternative_phone.toString();
			data.item.can_number = tissue.can_number.toString();
			data.item.type = tissue.type.toString();
	    var type = tissue.type;
	    if(type == 'Clinical Archives linked to protocol'){
					data.item.irb_protocol = tissue.irb_protocol_number.toString();
					data.item.patient_name = tissue.patient_name.toString();
					data.item.caseBlock1 = tissue.case_block_1.toString();
					data.item.caseBlock2 = tissue.case_block_2.toString(); 
					data.item.caseBlock3 = tissue.case_block_3.toString();				
					data.item.caseBlock4 = tissue.case_block_4.toString();
					data.item.caseBlock5 = tissue.case_block_5.toString();
					data.item.material_requested = tissue.material_being_requested.toString();
				  if(data.item.material_requested == 'Unstained Slides'){
						data.item.number_of_recuts = tissue.number_of_recuts.toString();
						data.item.requested_thickness = tissue.requested_thickness.toString();
					}else if(data.item.material_requested == 'Stained Slides'){
						data.item.he = tissue.he.toString() == 'true';
						data.item.special_stains = tissue.special_stains.toString() == 'true';
					}else if(data.item.material_requested == 'Tissue Shavings'){
						data.item.tissue_shaving_text = tissue.tissue_shaving_text.toString();
					}else if(data.item.material_requested == 'Slide Signout From LP'){
						data.item.slide_signout_from_lp_text = tissue.slide_signout_from_lp_text.toString();
					}else if(data.item.material_requested == 'Other Material'){
						data.item.other_material_specify = tissue.other_material_specify.toString();
					}else if(data.item.material_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'){
						data.item.ffpe_tissue_block_text = tissue.ffpe_tissue_block_text.toString();
					}
					data.item.special_processing_or_handling = tissue.special_processing_or_handling.toString();
					data.item.intent_to_use = tissue.intent_to_use.toString();
			}else if(type=='Clinical Archives unlinked'){
				  data.item.clinic_archives = tissue.clinic_archives.toString();
					data.item.caseBlock1 = tissue.case_block_2_1.toString();
					data.item.caseBlock2 = tissue.case_block_2_2.toString(); 
					data.item.caseBlock3 = tissue.case_block_2_3.toString();				
					data.item.caseBlock4 = tissue.case_block_2_4.toString();
					data.item.caseBlock5 = tissue.case_block_2_5.toString();
					data.item.material_requested = tissue.material_being_requested_2.toString();
					if(data.item.material_requested == 'Unstained Slides'){
						data.item.number_recuts = tissue.number_of_recuts2.toString();
						data.item.thickness = tissue.requested_thinkness2.toString();
					}else if(data.item.material_requested == 'Stained Slides'){
						data.item.he = tissue.he2.toString() == 'true';
						data.item.special_stains = tissue.special_stains2.toString() == 'true';
					}else if(data.item.material_requested == 'Tissue Shavings'){
						data.item.tissue_shaving_text = tissue.tissue_shaving_text_2.toString();
					}else if(data.item.material_requested == 'Slide Signout from LP'){
						data.item.slide_signout_from_lp_text = tissue.slide_signout_from_lp_text_2.toString();
					}else if(data.item.material_requested == 'Other Material'){
						data.item.other_material_specify = tissue.other_material_specify_2.toString();
					}else if(data.item.material_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'){
						data.item.ffpe_tissue_block_text = tissue.ffpe_tissue_block_text_2.toString();
					}
					data.item.special_processing_or_handling = tissue.special_processing_or_handling_2.toString();
					data.item.intent_to_use = tissue.intent_to_use_2.toString();				
			}else if(type=='Formalin - Fixed Paraffin - Embedded Biomedical Waste - Unlinked / Anonymized'){
					data.item.case_tissue_type = tissue.case_tissue_type.toString();
				  data.item.material_requested = tissue.material_being_requested_3.toString();
					if(data.item.material_requested == 'Unstained Slides'){
						data.item.number_recuts = tissue.number_of_recuts_per_slide_3.toString();
						data.item.thickness = tissue.requested_thickness_3.toString();
					}else if(data.item.material_requested == 'Stained Slides'){
						data.item.he = tissue.he3.toString() == 'true';
						data.item.special_stains = tissue.special_stains3.toString() == 'true';
					}else if(data.item.material_requested == 'Tissue Shavings'){
						data.item.tissue_shaving_text = tissue.tissue_shaving_text_3.toString();
					}else if(data.item.material_requested == 'Other Material'){
						data.item.other_material_specify = tissue.other_material_specify_3.toString();
					}else if(data.item.material_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'){
						data.item.ffpe_tissue_block_text = tissue.ffpe_tissue_block_text_3.toString();
					}				
					data.item.special_processing_or_handling = tissue.special_processing_or_handling_3.toString();
					data.item.intent_to_use = tissue.intent_to_use_3.toString();
			}else if(type=='Fresh Frozen normal non-tumor'){
					data.item.caseBlock1 = tissue.case_tissue_type_4_1.toString();
					data.item.caseBlock2 = tissue.case_tissue_type_4_2.toString(); 
					data.item.caseBlock3 = tissue.case_tissue_type_4_3.toString();				
					data.item.caseBlock4 = tissue.case_tissue_type_4_4.toString();
					data.item.caseBlock5 = tissue.case_tissue_type_4_5.toString();
				  data.item.material_requested = tissue.material_being_requested_4.toString();
				  data.item.intent_to_use = tissue.intend_to_use_4.toString();
			}else if(type=='Fresh Post-Mortem collection'){
					data.item.caseBlock1 = tissue.case_tissue_type_5_1.toString();
					data.item.caseBlock2 = tissue.case_tissue_type_5_2.toString(); 
					data.item.caseBlock3 = tissue.case_tissue_type_5_3.toString();				
					data.item.caseBlock4 = tissue.case_tissue_type_5_4.toString();
					data.item.caseBlock5 = tissue.case_tissue_type_5_5.toString();	
				  data.item.patient_name1 = tissue.patient_name_1.toString();
					data.item.patient_name2 = tissue.patient_name_2.toString();
					data.item.patient_name3 = tissue.patient_name_3.toString();
					data.item.patient_name4 = tissue.patient_name_4.toString();
					data.item.patient_name5 = tissue.patient_name_5.toString();
				  data.item.material_requested = tissue.material_being_requested_5.toString();
				  data.item.intent_to_use = tissue.intend_to_use_5.toString();
			}else if(type=='FFPE & Snap Frozen tumor w/ associated clinical data – WRNMMC Collaboration'){
					data.item.caseBlock1 = tissue.case_tissue_type_6_1.toString();
					data.item.caseBlock2 = tissue.case_tissue_type_6_2.toString(); 
					data.item.caseBlock3 = tissue.case_tissue_type_6_3.toString();				
					data.item.caseBlock4 = tissue.case_tissue_type_6_4.toString();
					data.item.caseBlock5 = tissue.case_tissue_type_6_5.toString();			
					data.item.material_requested = tissue.material_being_requested_6.toString();
				  data.item.intent_to_use = tissue.intend_to_use_6.toString();
			}else if(type=='Facilitated fresh tissue collection via CCR / WRNMMC Collaboration'){
				  data.item.project_title = tissue.project_title.toString();
				  data.item.project_start_date = tissue.project_start_date.toString();
				  data.item.project_complete_date = tissue.project_end_date.toString();
				  data.item.five_words = tissue.five_key_word.toString();
				  data.item.type_research = tissue.type_of_research.toString();
					data.item.disease_site = tissue.disease_or_site.toString();
				  data.item.summary = tissue.abstract_or_summary.toString();
			}
	    data.files = [];
			//find all attachments
			var attach = new GlideRecord('sys_attachment');
			attach.addQuery('table_name', 'x_naci_tissue_requ_tissue_resource_request');
			attach.addQuery('table_sys_id', sys_id);
			attach.orderByDesc('sys_created_on');
			attach.query();
			while(attach.next()){
				var file ={};
				file.name = attach.file_name.toString();
				file.sys_id = attach.sys_id.toString();
				data.files.push(file);
			}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>zhoujim@nih.gov</sys_created_by>
        <sys_created_on>2019-11-19 21:46:20</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>3c707a5cdb9d881054d8ff621f961979</sys_id>
        <sys_mod_count>336</sys_mod_count>
        <sys_name>Approve Tissue Request</sys_name>
        <sys_package display_value="Tissue Resource Request" source="x_naci_tissue_requ">80f86cc4dbf08c1054d8ff621f96197d</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Tissue Resource Request">80f86cc4dbf08c1054d8ff621f96197d</sys_scope>
        <sys_update_name>sp_widget_3c707a5cdb9d881054d8ff621f961979</sys_update_name>
        <sys_updated_by>zhoujim@nih.gov</sys_updated_by>
        <sys_updated_on>2019-11-22 22:57:34</sys_updated_on>
        <template><![CDATA[<div style="margin-bottom: 100px;" class="bg-white p-5">
  <h2>Tissue Resource Request</h2>  
  <hr>
  <div class="mt-5">
    <b class="mr-5">Tissue Resource Request Item Number</b>{{c.data.item.number}}   
  </div>
  <div class="row" style="margin-top: 20px;">
    <div class="col-md-12">
      <label class="label-bold">Principal Investigator</label>  
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      {{c.data.item.piName}}
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <label class="label-bold">Institution</label>
      {{c.data.item.institution}}
    </div>  
    <div class="col-md-6">
      <label class="label-bold">Branch</label>
      {{c.data.item.branch}}		
    </div> 
  </div>
  <div class="row">
    <div class="col-md-6">
      <label class="label-bold">Building</label>
      {{c.data.item.building}}
    </div>  
    <div class="col-md-6">
      <label class="label-bold">Room</label>
      {{c.data.item.room}}
    </div> 
  </div>
  <div class="row">
    <div class="col-md-6">
      <label class="label-bold">Phone</label>
      {{c.data.item.phone}}
    </div>  
    <div class="col-md-6">
      <label class="label-bold">Email</label>
      {{c.data.item.email}}
    </div> 
  </div>
  <div class="row">
    <div class="col-md-6" ng-show="!c.edit">
      <label class="label-bold">Alternative Contact</label>
      {{c.form.alternative_contact}}
    </div>  
    <div class="col-md-6" ng-show="c.edit">
      <label class="label-bold">Alternative Contact</label>
      <input class="form-control" ng-model="c.form.alternative_contact"/>
    </div>  
    <div class="col-md-6" ng-show="!c.edit">
      <label class="label-bold">Alternative Phone</label>
      {{c.form.alternative_phone}}
    </div> 
    <div class="col-md-6" ng-show="c.edit">
      <label class="label-bold">Alternative Phone</label>
      <input class="form-control" ng-model="c.form.alternative_phone"/>
    </div> 
  </div>
  <div class="row">
    <div class="col-md-12" ng-show="!c.edit">
      <label class="label-bold">CAN Number</label>
      {{c.form.can_number}}
    </div>
		<div class="col-md-12" ng-show="c.edit">
      <label class="label-bold">CAN Number</label>
      <input class="form-control" ng-model="c.form.can_number"/>
    </div>    
  </div>  
  <div class="row">
    <div class="col-md-12" ng-show="!c.edit">
      <label class="label-bold">Type</label>
      {{c.form.type}}
    </div>
    <div class="col-md-12" ng-show="c.edit">
      <label class="label-bold">Type</label>
      <select class="form-control" ng-model="c.form.type">
        <option value="Clinical Archives linked to protocol">	Clinical Archives linked to protocol</option>
        <option value="Clinical Archives unlinked">Clinical Archives unlinked</option>
        <option value="Formalin - Fixed Paraffin - Embedded Biomedical Waste - Unlinked / Anonymized">Formalin - Fixed Paraffin - Embedded Biomedical Waste - Unlinked / Anonymized</option>
        <option value="Fresh Frozen normal non-tumor">Fresh Frozen normal non-tumor</option>
        <option value="Fresh Post-Mortem collection">Fresh Post-Mortem collection</option>
        <option value="FFPE & Snap Frozen tumor w/ associated clinical data – WRNMMC Collaboration">FFPE & Snap Frozen tumor w/ associated clinical data – WRNMMC Collaboration</option>
        <option value="Facilitated fresh tissue collection via CCR / WRNMMC Collaboration">Facilitated fresh tissue collection via CCR / WRNMMC Collaboration</option>
      </select>
    </div>
  </div>  
<!-- type 1 Clinical Archives linked to protocol -->
  <div id="type1" ng-show = 'c.form.type == "Clinical Archives linked to protocol"'>
    <div class="row">
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Provide IRB Protocol #</label>
        {{c.form.irb_protocol_number}}
      </div>      
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Patient Name</label>
        {{c.form.patient_name}}
      </div>    
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Provide IRB Protocol #</label>
        <input class="form-control" ng-model="c.form.irb_protocol_number"/>
      </div>      
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Patient Name</label>
         <input class="form-control" ng-model="c.form.patient_name"/>
      </div>        
    </div>
    <div class="row">
      <div class="col-md-12">
        <label class="label-bold">Surgical Pathology or Cytology Case #(s)</label>
        <span>If requesting material from a case with multiple blocks, the requester must specify which block is being requested (e.g. SI-xx-1234, block 1A) Note: if needed, schedule a meeting with the LP Hotseat Resident or collaborating pathologist to select the most appropriate block(s).</span>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        {{c.form.case_block_1}}
      </div>
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        {{c.form.case_block_2}}
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        <input class="form-control" ng-model="c.form.case_block_1"/>
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        <input class="form-control" ng-model="c.form.case_block_2"/>
      </div>      
    </div>
    <div class="row">
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        {{c.form.case_block_3}}
      </div>
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        {{c.form.case_block_4}}
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        <input class="form-control" ng-model="c.form.case_block_3"/>
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        <input class="form-control" ng-model="c.form.case_block_4"/>
      </div>      
    </div>
    <div class="row">
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        {{c.form.case_block_5}}
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Case #, Block #(s)</label>
        <input class="form-control" ng-model="c.form.case_block_5"/>
      </div>
      <div class="col-md-6" ng-show="c.edit" style="margin-top:30px;">
        <input type="file" id="upload_file" style="margin-bottom:5px;">
        <button class="btn btn-primary" ng-click="c.uploadAttachment('upload_file')">Add Attachment</button>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Material Being Requested</label>
        {{c.form.material_being_requested}}
      </div>
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Material Being Requested</label>
         <select class="form-control" ng-model="c.form.material_being_requested">
           <option value="Unstained Slides">Unstained Slides</option>
           <option value="Stained Slides">Stained Slides</option>
           <option value="Tissue Shavings">Tissue Shavings</option>
           <option value="Slide Signout From LP">Slide Signout From LP</option>
           <option value="Other Material">Other Material</option>
           <option value="FFPE Tissue Block (formalin-fixed, paraffin-embedded)">FFPE Tissue Block (formalin-fixed, paraffin-embedded)</option>
        </select>
      </div>      
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Unstained Slides'">
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Number of recuts per slide</label>
        {{c.form.number_of_recuts}}
      </div>
      <div class="col-md-6" ng-show="!c.edit">
        <label class="label-bold">Requested thickness</label>
        {{c.form.requested_thickness}}
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Number of recuts per slide</label>
        <input class="form-control" ng-model="c.form.number_of_recuts"/>
      </div>
      <div class="col-md-6" ng-show="c.edit">
        <label class="label-bold">Requested thickness</label>
        <input class="form-control" ng-model="c.form.requested_thickness"/>
      </div>      
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Stained Slides'" style="margin-top: 20px;">
      <div class="col-md-12" ng-show="!c.edit">
        <input type="checkbox" ng-model="c.form.he" disabled='disabled'> H&E 
      </div>
      <div class="col-md-12" ng-show="c.edit">
        <input type="checkbox" ng-model="c.form.he"> H&E 
      </div>
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Stained Slides'">
      <div class="col-md-12" ng-show="!c.edit">
        <input type="checkbox" ng-model="c.form.special_stains" disabled='disabled'> If Special stains or IHC, must be via collaboration with an LP Pathlogist
      </div> 
      <div class="col-md-12" ng-show="c.edit">
        <input type="checkbox" ng-model="c.form.special_stains"> If Special stains or IHC, must be via collaboration with an LP Pathlogist
      </div>       
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Tissue Shavings'">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Specify</label>
        {{c.form.tissue_shaving_text}}
      </div> 
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Specify</label>
        <input class="form-control" ng-model="c.form.tissue_shaving_text"/>
      </div>      
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Slide Signout From LP'">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Specify</label>
        {{c.form.slide_signout_from_lp_text}}
      </div>   
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Specify</label>
        <input class="form-control" ng-model="c.form.slide_signout_from_lp_text"/>
      </div>        
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'Other Material'">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Specify</label>
        {{c.form.other_material_specify}}
      </div>      
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Specify</label>
        <input class="form-control" ng-model="c.form.other_material_specify">
      </div>      
    </div>
    <div class="row" ng-show="c.form.material_being_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'">
      <div class="col-md-12">
        <label class="label-bold">Note</label>
        <span>LP does not typically release tissue blocks from the clinical archived biomaterial. On a rare occasion, the LP Medical Director can authorize the temporary release of a clinical tissue block for additional non-LP clinical testing.</span>
      </div>       
    </div>
    <div class="row" ng-show="c.form.item.material_being_requested == 'FFPE Tissue Block (formalin-fixed, paraffin-embedded)'">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Specify</label>
        {{c.form.ffpe_tissue_block_text}}
      </div>       
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Specify</label>
        <input class="form-control" ng-model="c.form.ffpe_tissue_block_text"/>
      </div>       
    </div>
    <div class="row">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Specify any special processing or handling request (e.g. charged, RNAse free, etc)</label>
        {{c.form.special_processing_or_handling}}
      </div>
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Specify any special processing or handling request (e.g. charged, RNAse free, etc)</label>
        <input class="form-control" ng-model="c.form.special_processing_or_handling"/>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12" ng-show="!c.edit">
        <label class="label-bold">Intended use</label>
        {{c.form.intent_to_use}}
      </div>
      <div class="col-md-12" ng-show="c.edit">
        <label class="label-bold">Intended use</label>
        <textarea class="form-control" ng-model="c.form.intent_to_use" rows="5"></textarea>
      </div>
      
    </div>    
  </div>
  <!-- end of type 1-->
  
  <!-- show attachments -->
  <div class="row" ng-show='c.data.files.length > 0'>
    <div class="col-md-12">
      <label class="label-bold">Attachment(s)</label>
      <div ng-repeat='item in c.data.files' style="margin-top: 10px; margin-bottom:10px;"><a href='/api/naci/attachment_util/attachment/v1/{{item.sys_id}}' target="_BLANK">{{item.name}}</a><button class="btn btn-danger btn-sm" ng-show="c.edit" ng-click="c.deleteAttachment(item.sys_id)" style="float:right;">Remove</button></div>
    </div>
  </div>
  <!-- end of attachments -->
  <!-- comments history section -->
  <div class="mb-2 br-4" style="margin-top:20px; justify-content: right;" ng-show="!c.edit && c.data.comment.length > 0">
    <div class="title-bold">
      Approval Status
    </div>  
    <div class="table-responsive shadow ">
      <table class="table table-bordered table-hover">
        <thead>
          <tr class="bg-light-gray">
            <th>Role</th>
            <th>Approver</th>
            <th>Status</th>
            <th>Comments</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="item in c.data.comment">
            <td>{{item.role}}</td>
            <td>{{item.approver}}</td>
            <td>{{item.status}}</td>
            <td>{{item.comment}}</td>
            <td>{{item.time}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- end of comments history section -->
 <!-- comments section -->
 <div class="mb-2 br-4" style="margin-top:20px; justify-content: right;" ng-show="!c.edit && c.data.item.stage != 'Assigned to Local Staff'">
   <div class="title-bold">
     	Comments
   </div>
   <div>
     <textarea class="form-control" ng-model="c.form.comment" rows="5"></textarea>
   </div>
 </div>
  <!-- end of comments input section -->
  <!-- assign to local staff section -->
  <div class="row" style="margin-top:20px;" ng-show="c.data.isAdmin && !c.edit && c.data.item.stage != 'Assigned to Local Staff'">
    <div class="col-md-3">
      <label>Assign To</label> 
    </div>
    <div class="col-md-9">
      <select class="form-control" ng-model="c.form.assigned_to">
        <option value=''>Please select a staff member to assign to</option>
        <option ng-repeat='item in c.data.staffs' ng-value='item.value'>{{item.label}}</option>
      </select>
    </div>
  </div>
  <!-- end of assign -->
  <div class="row" style="margin-top:20px; justify-content: right;">
    <div class="col-md-12 action-buttons" style="text-align:right;">
      <button class="btn btn-primary" ng-click="c.approve()" ng-show="!c.edit && c.data.item.stage != 'Assigned to Local Staff'">
        APPROVE
      </button>
      <button class="btn btn-primary" ng-click="c.reject()" ng-show="!c.edit && c.data.item.stage != 'Assigned to Local Staff'">
        REJECT
      </button>
      <button class="btn btn-primary" ng-click="c.editMode()" ng-show="!c.edit && c.data.item.stage != 'Assigned to Local Staff'">
        EDIT
      </button>
      <button class="btn btn-primary" ng-click="c.saveRecord()" ng-show="c.edit">
        SAVE
      </button>
      <button class="btn btn-primary" ng-click="c.cancel()" ng-show="c.edit">
        CANCEL
      </button>  
      <button class="btn btn-primary" ng-click="c.notify()" ng-show="c.data.localStaff && c.data.item.stage == 'Assigned to Local Staff'">
        NOTIFY TO PICK UP
      </button>     
      <button class="btn btn-primary" ng-click="c.complete()" ng-show="c.data.localStaff && c.data.item.stage == 'Assigned to Local Staff'">
        COMPLETED
      </button>
      <button class="btn btn-primary" ng-click="c.backToHome()" ng-show="!c.edit">
        BACK
      </button>
    </div>
  </div> 
  <pre ng-if="c.debug">{{c.form | json}}</pre>
</div>]]></template>
    </sp_widget>
</record_update>
